apiVersion: tekton.dev/v1
kind: Task
metadata:
  name: deploy-and-test
spec:
  description: |
    This step runs the script that deploys RHDH and runs the tests
  params:
    - name: RHDH_SECRETS
      default: rhdh-secrets
  volumes:
    - name: rhdh-secrets
      secret: 
        secretName: $(params.RHDH_SECRETS)
  steps:
    - name: deploy-and-test
      image: ubuntu
      volumeMounts:
        - mountPath: /etc/secrets
          name: rhdh-secrets
          readOnly: true
      env:
        - name: RHDH_SECRETS
          value: $(params.RHDH_SECRETS)
      script: |
        #!/usr/bin/env bash
        export HOME WORKSPACE
        HOME=/tmp
        WORKSPACE=$(pwd)
        cd /tmp || exit
        ls -la /etc/secrets
        cat /etc/secrets/API_SERVER_URL
        # oc login ${apiServerUrl} --username=${username} --password=${password}
        # oc whoami --show-console
        # curl -sSLO https://raw.githubusercontent.com/rhdh-bot/openshift-helm-charts/redhat-developer-hub-1.2-150-CI/installation/install.sh && chmod +x install.sh
        # ./install.sh 1.2-150-CI --namespace showcase --chartrepo
        

